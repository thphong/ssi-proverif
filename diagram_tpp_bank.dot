digraph {
graph [ordering = out, rankdir=TB]
edge [arrowhead = none, penwidth = 1.6, fontsize = 30]
node [shape = point, width = 0, height = 0, fontsize = 30]
Trace [label = <Process to authenticate/authorize TPP<br/>
>, shape = plaintext]
P_Honest_Process [label = "Honest Process", shape = plaintext]
Trace -> P_Honest_Process [label = "", style = invisible, weight = 100]
P_Honest_Process -> P_L0_Root [label = <>, weight = 100]
/*RPar */
P_L0_Root -> P_L1_TPP [label = <>]
P_L0_Root -> P_L1_Bank [label = <>]
P_L0_Root -> P_L1_Resolver [label = <>]
P_L0_Root [label = "", fixedsize = false, width = 0, height = 0, shape = none]
P_L1_TPP [label = "!", shape = ellipse]
P_L1_Bank [label = "!", shape = ellipse]
P_L1_Resolver [label = "!", shape = ellipse]
{rank = same; P_L1_TPP P_L1_Bank P_L1_Resolver }

/*Level 2 */

P_L1_TPP -> P_L2_TPP [label = <>, weight = 100]
P_L1_Bank -> P_L2_Bank [label = <>, weight = 100]
P_L1_Resolver -> P_L2_Resolver [label = <>, weight = 100]
{rank = same; P_L2_TPP P_L2_Bank P_L2_Resolver }

P_L2_TPP [shape = plaintext, label = <<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4"> <TR><TD> <FONT COLOR="darkgreen">TPPProcess</FONT>(delegated verifiable credential DVC)</TD></TR></TABLE>>]
P_L2_Bank [shape = plaintext, label = <<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4"> <TR><TD><FONT COLOR="darkgreen">BankProcess</FONT></TD></TR></TABLE>>]
P_L2_Resolver [shape = plaintext, label = <<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4"> <TR><TD><FONT COLOR="darkgreen">DIDResolver</FONT></TD></TR></TABLE>>]

P_L2_TPP -> P_L2t_TPP [label = <>, weight = 100]
P_L2_Bank -> P_L2t_Bank [label = <>, weight = 100]
P_L2_Resolver -> P_L2t_Resolver [label = <>, weight = 100]
{rank = same; P_L2t_TPP P_L2t_Bank P_L2t_Resolver }


/*Level 3 */

P_L2t_TPP -> P_L3_TPP [label = <>, weight = 100]
P_L2t_Resolver -> P_L3_Resolver [label = <>, weight = 100]
{rank = same; P_L3_TPP P_L3_Resolver }
P_L3_TPP -> P_L3_Resolver [label = <didB>, arrowhead = normal]

P_L3_TPP -> P_L3t_TPP [label = <>, weight = 100]
P_L2t_Bank -> P_L3t_Bank [label = <>, weight = 100]
P_L3_Resolver -> P_L3t_Resolver [label = <>, weight = 100]
{rank = same; P_L3t_TPP P_L3t_Bank P_L3t_Resolver }


/*Level 4 with box */

P_L3t_TPP -> P_L4_TPP [label = <>, weight = 100]
P_L3t_Resolver -> P_L4_Resolver [label = <>, weight = 100]
{rank = same; P_L4_TPP P_L4_Resolver }
P_L4_TPP -> P_L4_Resolver [label = <pkB>, dir = back, arrowhead = normal]

P_L4_TPP -> P_L4t_TPP [label = <>, weight = 100]
P_L3t_Bank -> P_L4t_Bank [label = <>, weight = 100]
P_L4_Resolver -> P_L4t_Resolver [label = <>, weight = 100]
{rank = same; P_L4t_TPP P_L4t_Bank P_L4t_Resolver }

/*Level 3-didU */

P_L4t_TPP -> P_L3didU_TPP [label = <>, weight = 100]
P_L4t_Resolver -> P_L3didU_Resolver [label = <>, weight = 100]
{rank = same; P_L3didU_TPP P_L3didU_Resolver }
P_L3didU_TPP -> P_L3didU_Resolver [label = <didU>, arrowhead = normal]

P_L3didU_TPP -> P_L3didUt_TPP [label = <>, weight = 100]
P_L4t_Bank -> P_L3didUt_Bank [label = <>, weight = 100]
P_L3didU_Resolver -> P_L3didUt_Resolver [label = <>, weight = 100]
{rank = same; P_L3didUt_TPP P_L3didUt_Bank P_L3didUt_Resolver }

/*Level 4-didU */

P_L3didUt_TPP -> P_L4didU_TPP [label = <>, weight = 100]
P_L3didUt_Resolver -> P_L4didU_Resolver [label = <>, weight = 100]
{rank = same; P_L4didU_TPP P_L4didU_Resolver }
P_L4didU_TPP -> P_L4didU_Resolver [label = <pkU>, dir = back, arrowhead = normal]

P_L4didU_TPP -> P_L4didUt_TPP [label = <>, weight = 100]
P_L4didUt_TPP [shape = plaintext, label = <<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4"> <TR><TD><FONT COLOR="red">Verify</FONT> pkU, pkB with DVC</TD></TR></TABLE>>]
P_L3didUt_Bank -> P_L4didUt_Bank [label = <>, weight = 100]
P_L4didU_Resolver -> P_L4didUt_Resolver [label = <>, weight = 100]
{rank = same; P_L4didUt_TPP P_L4didUt_Bank P_L4didUt_Resolver }

P_L4didUt_TPP -> P_L4didUtt_TPP [label = <>, weight = 100]
P_L4didUt_Bank -> P_L4didUtt_Bank [label = <>, weight = 100]
P_L4didUt_Resolver -> P_L4didUtt_Resolver [label = <>, weight = 100]
{rank = same; P_L4didUtt_TPP P_L4didUtt_Bank P_L4didUtt_Resolver }

/*Level 5 */

P_L4didUtt_TPP -> P_L5_TPP [label = <>, weight = 100]
P_L4didUtt_Bank -> P_L5_Bank [label = <>, weight = 100]
{rank = same; P_L5_TPP P_L5_Bank }
P_L5_TPP -> P_L5_Bank [label = <aenc((didReq=didTPP,didOri=didU,pkTPP),pkB)>, arrowhead = normal]

P_L5_TPP -> P_L5t_TPP [label = <>, weight = 100]
P_L5_Bank -> P_L5t_Bank [label = <>, weight = 100]
P_L4didUtt_Resolver -> P_L5t_Resolver [label = <>, weight = 100]
{rank = same; P_L5t_TPP P_L5t_Bank P_L5t_Resolver }

/*Level 6 */

P_L5t_TPP -> P_L6_TPP [label = <>, weight = 100]
P_L5t_Bank -> P_L6_Bank [label = <>, weight = 100]
{rank = same; P_L6_TPP P_L6_Bank }
P_L6_TPP -> P_L6_Bank [label = <aenc((didReq,didOri,<FONT COLOR="blue">new </FONT>nonce),pkTPP)>, dir = back, arrowhead = normal]

P_L6_TPP -> P_L6t_TPP [label = <>, weight = 100]
P_L6t_TPP [shape = plaintext, label = <<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4"> <TR><TD><FONT COLOR="red">Verify</FONT> didReq=didTPP,didOri=didU</TD></TR></TABLE>>]
P_L6_Bank -> P_L6t_Bank [label = <>, weight = 100]
P_L5t_Resolver -> P_L6t_Resolver [label = <>, weight = 100]
{rank = same; P_L6t_TPP P_L6t_Bank P_L6t_Resolver }

P_L6t_TPP -> P_L6tt_TPP [label = <>, weight = 100]
P_L6tt_TPP [shape = plaintext, label = <<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4"> <TR><TD>Make verifiable presentation VP</TD></TR></TABLE>>]
P_L6t_Bank -> P_L6tt_Bank [label = <>, weight = 100]
P_L6t_Resolver -> P_L6tt_Resolver [label = <>, weight = 100]
{rank = same; P_L6tt_TPP P_L6tt_Bank P_L6tt_Resolver }

/*Level 7 */

P_L6tt_TPP -> P_L7_TPP [label = <>, weight = 100]
P_L6tt_Bank -> P_L7_Bank [label = <>, weight = 100]
{rank = same; P_L7_TPP P_L7_Bank }
P_L7_TPP -> P_L7_Bank [label = <aenc(VP,pkB)>, arrowhead = normal]

P_L7_TPP -> P_L7t_TPP [label = <>, weight = 100]
P_L7_Bank -> P_L7t_Bank [label = <>, weight = 100]
P_L6tt_Resolver -> P_L7t_Resolver [label = <>, weight = 100]
{rank = same; P_L7t_TPP P_L7t_Bank P_L7t_Resolver }

/*Level 8 */

P_L7t_Bank -> P_L8_Bank [label = <>, weight = 100]
P_L7t_Resolver -> P_L8_Resolver [label = <>, weight = 100]
{rank = same; P_L8_Bank P_L8_Resolver }
P_L8_Bank -> P_L8_Resolver [label = <did_vc_issuer>, arrowhead = normal]

P_L7t_TPP -> P_L8t_TPP [label = <>, weight = 100]
P_L8_Bank -> P_L8t_Bank [label = <>, weight = 100]
P_L8_Resolver -> P_L8t_Resolver [label = <>, weight = 100]
{rank = same; P_L8t_TPP P_L8t_Bank P_L8t_Resolver }

/*Level 9 */

P_L8t_Bank -> P_L9_Bank [label = <>, weight = 100]
P_L8t_Resolver -> P_L9_Resolver [label = <>, weight = 100]
{rank = same; P_L9_Bank P_L9_Resolver }
P_L9_Bank -> P_L9_Resolver [label = <pkIssuer>, dir = back, arrowhead = normal]

P_L8t_TPP -> P_L9t_TPP [label = <>, weight = 100]
P_L9_Bank -> P_L9t_Bank [label = <>, weight = 100]
P_L9t_Bank [shape = plaintext, label = <<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4"> <TR><TD><FONT COLOR="red">Verify</FONT> VP with (pkTPP, pkIssuer) <br/> <FONT COLOR="red">Verify</FONT> parent VC with pkB and parent issuer = didB</TD></TR></TABLE>>]
P_L9_Resolver -> P_L9t_Resolver [label = <>, weight = 100]
{rank = same; P_L9t_TPP P_L9t_Bank P_L9t_Resolver }

P_L9t_TPP -> P_L9tt_TPP [label = <>, weight = 100]
P_L9t_Bank -> P_L9tt_Bank [label = <>, weight = 100]
P_L9tt_Bank [shape = plaintext, label = <<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4"> <TR><TD><FONT COLOR="blue">new </FONT>token</TD></TR></TABLE>>]
P_L9t_Resolver -> P_L9tt_Resolver [label = <>, weight = 100]
{rank = same; P_L9tt_TPP P_L9tt_Bank P_L9tt_Resolver }

/*Level 10 */

P_L9tt_TPP -> P_L10_TPP [label = <>, weight = 100]
P_L9tt_Bank -> P_L10_Bank [label = <>, weight = 100]
{rank = same; P_L10_TPP P_L10_Bank }
P_L10_TPP -> P_L10_Bank [label = <aenc(token,pkU)>, dir = back, arrowhead = normal]

P_L10_TPP -> P_L10t_TPP [label = <>, weight = 100]
P_L10_Bank -> P_L10t_Bank [label = <>, weight = 100]
P_L10t_TPP [label = "", width = 0.3, height = 0.3]
P_L9tt_Resolver -> P_L10t_Resolver [label = <>, weight = 100]
{rank = same; P_L10t_TPP P_L10t_Bank P_L10t_Resolver }


}